{% load static %}
<!DOCTYPE html>
<html>

<head>
    <title>{% block title %}{% endblock %}</title>
    <link href="{% static "css/base.css" %}" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700,800,900" rel="stylesheet">
    
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static "css/style.css" %}">
    <link rel="stylesheet" href="{% static "css/autocomplete.css" %}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous">
    </script>
    <link href="https://cdn.rawgit.com/davidstutz/bootstrap-multiselect/master/dist/css/bootstrap-multiselect.css"
        rel="stylesheet" type="text/css" />
</head>

<body>
    <div class="wrapper d-flex align-items-stretch">
        <nav id="sidebar" class="bg-success">
            <div class="custom-menu">
                <button type="button" id="sidebarCollapse" class="btn btn-success bg-success">
                    <i class="fa fa-bars"></i>
                    <span class="sr-only">Toggle Menu</span>
                </button>
            </div>
            <div class="p-4">
                <h1><a href="index.html" class="logo">User Story</a></h1>
                <ul class="list-unstyled components mb-5">
                    <li class="active">
                        <a href="{% url 'users' %}"><span class="text-white fa fa-user mr-3"></span> Users</a>
                    </li>
                    <li class="active">
                        <a href="{% url 'userStories' %}"><span class="text-white fa fa-address-book mr-3"></span> UserStories</a>
                    </li>
                    <li class="active">
                        <a href="{% url 'userStoryVersions' %}"><span class="text-white fa fa-address-card mr-3"></span> UserStoriesVersion</a>
                    </li>
                    <li class="active">
                        <a href="{% url 'Projects' %}"><span class="text-white fa fa-address-card mr-3"></span>
                            Projects</a>
                    </li>
                    <li class="active">
                        <a href="{% url 'Business' %}"><span class="text-white fa fa-address-card mr-3"></span>
                            Business</a>
                    </li>
                    <!-- <li>
                        <a href="#"><span class="text-white fa fa-user mr-3"></span> About</a>
                    </li>
                    <li>
                        <a href="#"><span class="text-white fa fa-briefcase mr-3"></span> Works</a>
                    </li>
                    <li>
                        <a href="#"><span class="text-white fa fa-sticky-note mr-3"></span> Blog</a>
                    </li>
                    <li>
                        <a href="#"><span class="text-white fa fa-suitcase mr-3"></span> Gallery</a>
                    </li>
                    <li>
                        <a href="#"><span class="text-white fa fa-cogs mr-3"></span> Services</a>
                    </li>
                    <li>
                        <a href="#"><span class="text-white fa fa-paper-plane mr-3"></span> Contacts</a>
                    </li> -->
                </ul>
            </div>
        </nav>
        <div id="content" class="p-4 p-md-5 pt-5">
            {% block content %}
            {% endblock %}
        </div>
        <!-- Page Content  -->
    </div>
    
    <script src="{% static "js/jquery.min.js" %}"></script>
    <script src="{% static "js/popper.js" %}"></script>
    <script src="{% static "js/bootstrap.min.js" %}"></script>
    <script src="{% static "js/main.js" %}"></script>
    <script src="{% static "js/jquery.bootstrap.modal.forms.js" %}"></script>
    <script src="{% static "js/autocomplete.js" %}"></script>
    <script src="{% static "js/filterAutocomplete.js" %}"></script>
    <!-- You can alternatively load the minified version -->
    <script src="{% static "js/jquery.bootstrap.modal.forms.min.js" %}"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
    <script src="https://cdn.rawgit.com/davidstutz/bootstrap-multiselect/master/dist/js/bootstrap-multiselect.js"
        type="text/javascript">
        </script>
    <script>
        $('#example-getting-started').multiselect({
                buttonClass: 'form-select',
                templates: {
                    button: '<button type="button" style="width: 15rem;" class="multiselect dropdown-toggle form-control" data-bs-toggle="dropdown"><span class="multiselect-selected-text"></span></button>',
                }
            });
        $('#example-getting-started1').multiselect({
                buttonClass: 'form-select',
                templates: {
                    button: '<button type="button" style="width: 15rem;" class="multiselect dropdown-toggle form-control" data-bs-toggle="dropdown"><span class="multiselect-selected-text"></span></button>',
                }
            });
        $('#example-getting-started2').multiselect({
                buttonClass: 'form-select',
                templates: {
                    button: '<button type="button" style="width: 15rem;" class="multiselect dropdown-toggle form-control" data-bs-toggle="dropdown"><span class="multiselect-selected-text"></span></button>',
                }
            });
        $('#example-getting-started3').multiselect({
                buttonClass: 'form-select',
                templates: {
                    button: '<button type="button" style="width: 15rem;" class="multiselect dropdown-toggle form-control" data-bs-toggle="dropdown"><span class="multiselect-selected-text"></span></button>',
                }
            });
        $('#example-getting-started4').multiselect({
                buttonClass: 'form-select',
                templates: {
                    button: '<button type="button" style="width: 18.5rem;" class="multiselect dropdown-toggle form-control" data-bs-toggle="dropdown"><span class="multiselect-selected-text"></span></button>',
                }
            });
        function remove(e) {
            e.parentNode.remove();
        }
        $(".AddRaids").on('click', function (e) {
            var currentValue = $(".Raids").val()
            if(currentValue){
                $(".Raids").val("")
                $('<input type="text" class="form-control Raids col-10" name="RAIDS" value="' + currentValue + '" id="exampleInputEmail1" aria-describedby="emailHelp" placeholder="R.A.I.DS">').prependTo($('<div class="form-group row"><i class="col-2 m-auto btn btn-success fa fa-minus" onclick="remove(this)" style="display: flex;justify-content: center;align-items: center;"</i></div>').prependTo($('<div style="width:100%;" class="row"></div>').prependTo($('.RAIDSDiv'))));
            //elem.val(elem.val() + 'add this');
            }
        });
        $(".AddDev").on('click', function (e) {
            var currentValue = $(".Dev").val()
            if(currentValue){
                $(".Dev").val("")
                $('<input type="text" class="form-control col-10" name="Dev" value="' + currentValue + '" id="exampleInputEmail1" aria-describedby="emailHelp" placeholder="Dev Tasks">').prependTo($('<div class="form-group row"><i class="col-2 m-auto btn btn-success fa fa-minus" onclick="remove(this)" style="display: flex;justify-content: center;align-items: center;"</i></div>').prependTo($('<div style="width:100%;" class="row"></div>').prependTo($('.DKDiv'))));
                //elem.val(elem.val() + 'add this');
            }
            });
        $(".AddPersona").on('click', function (e) {
                var currentValue = $(".Persona").val()
                if(currentValue){
                    $(".Persona").val("")
                    $('<input type="text" class="form-control col-10" name="Persona" value="' + currentValue + '" id="exampleInputEmail1" aria-describedby="emailHelp" placeholder="Persona">').prependTo($('<div class="form-group row"><i class="col-2 m-auto btn btn-success fa fa-minus" onclick="remove(this)" style="display: flex;justify-content: center;align-items: center;"</i></div>').prependTo($('<div style="width:100%;" class="row"></div>').prependTo($('.PersonDiv'))));
                //elem.val(elem.val() + 'add this');
                }
            });
        $(".AddEstimates").on('click', function (e) {
                var currentValue = $(".Estimates").val()
                $(".Estimates").val("")
                //elem.val(elem.val() + 'add this');
            });
        // $('input').change(function (e) {

        //         console.log("dv");
        //         document.getElementById("form").submit();
        //     });
        $(".Persona").keyup(function (e) {
            var key = e.charCode || e.keyCode || 0;
            if (key == 13)
            {
                var currentValue = $(".Persona").val()
                if(currentValue){
                    $(".Persona").val("")
                    $('<input type="text" class="form-control col-10" name="Persona" value="' + currentValue + '" id="exampleInputEmail1" aria-describedby="emailHelp" placeholder="Persona">').prependTo($('<div class="form-group row"><i class="col-2 m-auto btn btn-success fa fa-minus" onclick="remove(this)" style="display: flex;justify-content: center;align-items: center;"</i></div>').prependTo($('<div style="width:100%;" class="row"></div>').prependTo($('.PersonDiv'))));
                }
            }
        });

        $(".Dev").keypress(function (e) {
                var key = e.charCode || e.keyCode || 0;
                if (key == 13) {
                    var currentValue = $(".Dev").val()
                    if(currentValue){
                        $(".Dev").val("")
                        $('<input type="text" class="form-control col-10" name="Dev" value="' + currentValue + '" id="exampleInputEmail1" aria-describedby="emailHelp" placeholder="Dev Tasks">').prependTo($('<div class="form-group row"><i class="col-2 m-auto btn btn-success fa fa-minus" onclick="remove(this)" style="display: flex;justify-content: center;align-items: center;"</i></div>').prependTo($('<div style="width:100%;" class="row"></div>').prependTo($('.DKDiv'))));
                        
                    }
                }
        });

        $(".Raids").keypress(function (e) {
                var key = e.charCode || e.keyCode || 0;
                if (key == 13) {
                    var currentValue = $(".Raids").val()
                    if(currentValue){
                        console.log(currentValue);
                        $(".Raids").val("")
                        $('<input type="text" class="form-control col-10" name="RAIDS" value="' + currentValue + '" id="exampleInputEmail1" aria-describedby="emailHelp" placeholder="R.A.I.DS">').prependTo($('<div class="form-group row"><i class="col-2 m-auto btn btn-success fa fa-minus" onclick="remove(this)" style="display: flex;justify-content: center;align-items: center;"</i></div>').prependTo($('<div style="width:100%;" class="row"></div>').prependTo($('.RAIDSDiv'))));
                        
                    }
                }
        });

        $('.filter').change(function(){
            $('form').submit();
        });

        $('.filter').keypress(function () {
            var key = e.charCode || e.keyCode || 0;
            console.log(key);
            if (key == 13) {
                $('form').submit();
            }
        });

        $("input").keypress(function (e) {
                var key = e.charCode || e.keyCode || 0;
                if (key == 13) {
                    e.preventDefault();
                }
        });

        var keys = {};

        $('body').keydown(function (e) {
            keys[e.which] = true;
            console.log(keys);
            if(keys[13] && keys[17]){
                if ($('form')) {
                    $('form').submit();
                }
            }
            if (keys[13] && keys[16]) {
                if ($('form')) {
                    alert("dc");
                    var status = document.getElementById("status");
                    status.checked = true;
                    $('form').submit();
                }
            }
        });

        $('body').keyup(function (e) {
            delete keys[e.which];
        });

        $(".AddUserStory").on('click', function (e) {
                var status = document.getElementById("status");
                status.checked  = true;
                $('.submit').trigger('click');
            });
        $(".group").on('click', function (e) {
                var name = $(".groupName").attr("data-original-title");
                $(".groupField").val(name);
            });
        $('.business').change(function () {
            var projects = JSON.parse('{{project|safe}}');
            console.log(projects);
            $(".projectOption").remove();
            projects.forEach(project => {
                if (project['business'] == $(".business").val()){
                    $('.project').append($('<option class="projectOption" value=' + project['id'] + '>' + project['name'] + '</option>'));
                }
            });
        });
        estimateList =[]
        var platfrom = ""
        $('.platform').change(function () {
                var list = $(".platform").val();
                if($('.estimate').length){
                    for(var i=0;i< $('.estimate').length;i++){
                        var estimate = document.getElementsByClassName('estimate')[i];
                        if(!list.includes(estimate.id)){
                            estimate.parentNode.remove();
                        }
                    }
                }
                var index = 0;
                list.forEach(i=>{
                    var currentPlatform = $('.platform option:selected').text();
                    platfrom = currentPlatform.split(',');
                    if(!estimateList.includes(i)&& platfrom[index]){
                        $('.estimateDiv').append($('<div class="col-6 form-group" id="' + platfrom[index] + '"><label for="exampleInputEmail1">' + platfrom[index] +'</label><input type="number" id="' + i + '" class="form-control estimate" required name="estimate[]" placeholder="'+ platfrom[index] +'" aria-describedby="emailHelp"></div>'));
                    }
                    index ++;
                });
                estimateList = list;
            });
        
        
        $('.delUserStory').on('click', function (e) {
            e.target.closest('.parent').remove();
            });
        $('[data-toggle="tooltip"]').tooltip();
        if (window.history.replaceState) {
                window.history.replaceState(null, null, window.location.href);
            }

        function showmenu(e) {
                e.target.nextElementSibling.classList.toggle("show");
            }
        window.onclick = function (event) {
                if (!event.target.matches('.dropbtn')) {
                    var dropdowns = document.getElementById("myDropdown");
                    if(dropdowns){
                        if (dropdowns.classList.contains('show')) {
                            console.log(dropdowns);
                            dropdowns.classList.remove('show');
                        }
                    }
                    // for (i = 0; i < dropdowns.length; i++) {
                    //     var openDropdown = dropdowns[i];
                    //     if (openDropdown.classList.contains('show')) {
                    //         openDropdown.classList.remove('show');
                    //     }
                    // }
                }
            }  // Close the dropdown if the user clicks outside of 
        
        try 
        {
            if (JSON.parse('{{personaObjects|safe}}')) {
                var personaObjects = JSON.parse('{{personaObjects|safe}}');
                autocomplete(document.getElementById("myInput"), personaObjects);
            }
            if (JSON.parse('{{epicObjects|safe}}')) {
                var epicObjects = JSON.parse('{{epicObjects|safe}}');
                autocomplete(document.getElementById("epicInput"), epicObjects);
            }
            if (JSON.parse('{{iWantTOObjects|safe}}')) {
                var epicObjects = JSON.parse('{{iWantTOObjects|safe}}');
                filterAutocomplete(document.getElementById("id_iWantTO"), epicObjects);
            }
            if (JSON.parse('{{epicObjects|safe}}')) {
                var epicObjects = JSON.parse('{{epicObjects|safe}}');
                filterAutocomplete(document.getElementById("epicFilter"), epicObjects);
            }
        }
        catch (err) {
            
        }
    </script>
</body>
    
</html>